<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Registro RegistrAPP</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <div class="top-button-container">
    <ion-button class="top-button" fill="clear" (click)="goToLogin()">Volver a Inicio
      <ion-icon name="chevron-back-sharp" slot="start"></ion-icon>
    </ion-button>
  </div>

  <form [formGroup]="registerForm" (ngSubmit)="registerUser()">
    <div class="input">
      <ion-item>
        <ion-input
          label="Primer nombre"
          label-placement="floating"
          formControlName="primerNombre"
          required
        ></ion-input>
      </ion-item>
      
      <ion-item>
        <ion-input
          label="Segundo nombre"
          label-placement="floating"
          formControlName="segundoNombre"
        ></ion-input>
      </ion-item>

      <ion-item>
        <ion-input
          label="Primer apellido"
          label-placement="floating"
          formControlName="primerApellido"
          required
        ></ion-input>
      </ion-item>

      <ion-item>
        <ion-input
          label="Segundo apellido"
          label-placement="floating"
          formControlName="segundoApellido"
          required
        ></ion-input>
      </ion-item>

      <ion-item>
        <ion-input
          label="Correo Institucional"
          label-placement="stacked"
          formControlName="email"
          type="email"
          placeholder="Ejemplo: no.apellido@duocuc.cl o no.apellido@profesor.duoc.cl"
        ></ion-input>
      </ion-item>

      <ion-text 
        color="danger" 
        *ngIf="registerForm.get('email')?.hasError('invalidEmail') && registerForm.get('email')?.touched"
      >
        {{ registerForm.get('email')?.getError('invalidEmail') }}
      </ion-text>

      <ion-item id="password">
        <ion-input
          label="Contraseña"
          label-placement="floating"
          [type]="passwordInputType"
          formControlName="password"
          placeholder="Introduce tu contraseña"
          (ionInput)="validatePassword($event.detail.value ?? '')"

        ></ion-input>
        <ion-button fill="clear" slot="end" (click)="togglePasswordVisibility()">
          <ion-icon [name]="passwordInputType === 'password' ? 'eye-off' : 'eye'"></ion-icon>
        </ion-button>
      </ion-item>
      
      
      <ion-list class="password-requirements">
        <ion-item>
          
          <ion-icon 
            [color]="requirements.length ? 'success' : 'danger'" 
            [name]="requirements.length ? 'checkmark-circle' : 'close-circle'">
          </ion-icon>
          <ion-label>10 caracteres</ion-label>
        </ion-item>
      
        <ion-item>
          
          <ion-icon 
            [color]="requirements.uppercase ? 'success' : 'danger'" 
            [name]="requirements.uppercase ? 'checkmark-circle' : 'close-circle'">
          </ion-icon>
          <ion-label>1 mayúscula</ion-label>
        </ion-item>
      
        <ion-item>
          
          <ion-icon 
            [color]="requirements.number ? 'success' : 'danger'" 
            [name]="requirements.number ? 'checkmark-circle' : 'close-circle'">
          </ion-icon>
          <ion-label>1 número</ion-label>
        </ion-item>
      
        <ion-item>
          
          <ion-icon 
            [color]="requirements.special ? 'success' : 'danger'" 
            [name]="requirements.special ? 'checkmark-circle' : 'close-circle'">
          </ion-icon>
          <ion-label>1 carácter especial</ion-label>
        </ion-item>
      </ion-list>
      
      
      
      <ion-item class="input-item">
        <ion-input
          label="Repite la contraseña"
          label-placement="floating"
          formControlName="confirmPassword"
          type="password"
          placeholder="Repite tu contraseña"
        ></ion-input>
        <ion-button fill="clear" slot="end" (click)="togglePasswordVisibility()">
          <ion-icon [name]="passwordInputType === 'password' ? 'eye-off' : 'eye'"></ion-icon>
        </ion-button>
      </ion-item>
      
      <ion-text color="danger" *ngIf="registerForm.hasError('passwordsDontMatch') && registerForm.get('confirmPassword')?.touched">
        Las contraseñas no coinciden.
      </ion-text>

      <ion-item>
        <ion-label>Código de recuperación</ion-label>
        <ion-label>{{ recoveryCode }}</ion-label>
        <ion-button fill="clear" (click)="copyCode(recoveryCode)">
          <ion-icon slot="icon-only" name="copy-outline"></ion-icon>
        </ion-button>
      </ion-item>
    </div>
  
    <div class="register-button-container">
      <ion-button expand="full" type="submit" [disabled]="!registerForm.valid" (click)="goToLogin()">Registrarse</ion-button>
    </div>
  </form>
</ion-content>
